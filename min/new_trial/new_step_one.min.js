$(document).ready(()=>{let d,s=null,i=a=>{var e={email:"Podaj poprawny adres e-mail.",required:"To pole jest wymagane."};return e[a]||e.required},a=a=>{var e=a.val().trim(),t=SharedUtils.EMAIL_REGEX||/^[^\s@]+@[^\s@]+\.[^\s@]+$/;let l=null;return e?t.test(e)||(l=i("email")):l=i("required"),a.next(".error-box").remove(),l?(a.after(`<span class="error-box">${l}</span>`),a.removeClass("valid").addClass("invalid"),a.siblings(".new__input-label").removeClass("valid active").addClass("invalid")):(a.removeClass("invalid").addClass("valid"),a.siblings(".new__input-label").removeClass("invalid").addClass("valid")),l},e=(t,l)=>{t.preventDefault();let i=l.find('[data-type="email"]');if(!a(i)){let e=l.next().next(),a=l.find(".loading-in-button.is-inner");a.show(),d&&d.abort&&d.abort();var o={action:l.data("action"),email:i.val(),"adwords[gclid]":window.myGlobals.gclidValue,"adwords[fbclid]":window.myGlobals.fbclidValue,analyticsId:window.myGlobals.analyticsId,affiliant:l.data("affiliant")||"",...DataLayerGatherers.getValueTrackData()},n=localStorage.getItem("sid");if(n)try{var r=JSON.parse(n);r.value&&(o.sid=r.value)}catch(t){console.error("Failed to parse SID from localStorage:",t)}s&&(o.sid=s),(d=$.ajax({url:SharedUtils.API_URL,method:"POST",timeout:3e4,data:o})).then(a=>{SharedUtils.handleResponse(a,l,i,e,!0,1),$(document).trigger("trialStepComplete",[1,a])}).catch(a=>{SharedUtils.handleResponse(a,l,i,e,!1,1)}).always(()=>{a.hide(),d=null})}};let t=$("[data-element='open_trial_wrapper']");t.length&&t.on("click",()=>{$trialsWrapper.show(),$("body").addClass("overflow-hidden")});var l=$("[data-element='close_trial_wrapper']");l.length&&l.on("click",()=>{$trialsWrapper.hide(),$("body").removeClass("overflow-hidden")}),$(document).on("trialStepComplete",function(a,e,t){var l,i;1===e&&($trialsWrapper.show(),e=$('[data-element="modal_trial_one"]'),l=$('[data-element="modal_trial_two"]'),i=$('[data-element="modal_trial_three"]'),e.length&&e.hide(),"#create_trial_step3"===t.step?(l.length&&l.hide(),i.length&&i.show()):l.length&&l.show(),console.log("Step 1 completed successfully"))}),$(document).on("blur",'[data-action="create_trial_step1"] [data-type="email"]',function(){a($(this))}),$(document).on("keydown",'[data-action="create_trial_step1"] [data-type="email"]',function(a){"Enter"===a.key&&(a.preventDefault(),e(a,$(this).closest("form")))}),$(document).on("click",'[data-action="create_trial_step1"] [data-form="submit-step-one"]',function(a){e(a,$(this).closest("form"))}),$(document).on("submit",'[data-action="create_trial_step1"]',function(a){e(a,$(this))}),SharedUtils.checkAndUpdateSID(),setInterval(SharedUtils.checkAndUpdateSID,36e5),"function"==typeof updateAnalytics?updateAnalytics():console.warn("updateAnalytics function is not defined");let o=()=>{d&&d.abort(),$(document).off("blur",'[data-action="create_trial_step1"] [data-type="email"]'),$(document).off("keydown",'[data-action="create_trial_step1"] [data-type="email"]'),$(document).off("click",'[data-action="create_trial_step1"] [data-form="submit-step-one"]'),$(document).off("submit",'[data-action="create_trial_step1"]'),t.off("click")};$(window).on("beforeunload",o)}),$(document).on("formSubmissionComplete",function(a,e,t,l,i){e?DataLayerGatherers.pushEmailSubmittedData(window.myGlobals.clientId,window.myGlobals.shopId,t.data("action"),l.val()):DataLayerGatherers.pushTrackEventError(t.data("action"),t.find("#label").text(),l.val())});