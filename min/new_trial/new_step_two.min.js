$(document).ready(function(){let a={errors:[],phoneRegex:window.validationPatterns.phone};function s(e,o){e.addClass("error");let t=e.siblings(".error-box");(t=0===t.length?$('<div class="error-box"></div>').insertAfter(e):t).text(o).show()}function r(e,o,t){console.log("handleFormSubmission called");let r=o.closest("form"),n=r.find(".w-form-fail");o.trigger("blur");var l=DataLayerGatherers.getValueTrackData();let s=r.find(".loading-in-button.is-inner"),i={action:"create_trial_step2",phone:t.getNumber(),formid:"create_trial_step2",eventname:"formSubmitSuccess","adwords[gclid]":window.myGlobals.gclidValue,"adwords[fbclid]":window.myGlobals.fbclidValue,analytics_id:window.myGlobals.analyticsId,sid:SharedUtils.getCurrentSID()};l&&Object.entries(l).forEach(([e,o])=>{"timestamp"!==e&&(i[e]=o)}),0===a.errors.length?(console.log("No validation errors, submitting form"),l=t.getNumber().replace(/(\+48)(\d{3})(\d{3})(\d{1})(\d{2})/,"$1 *** *** *$4$5"),localStorage.setItem("phoneNumber",l),$.ajax({type:"POST",url:SharedUtils.API_URL,data:i,beforeSend:function(){s.show()},success:function(e){console.log("Form submission successful"),SharedUtils.handleResponse(e,r,o,n,!0,2)},error:function(e){console.log("Form submission failed"),SharedUtils.handleResponse(e,r,o,n,!1,2)},complete:function(){s.hide()}})):(console.log("Validation errors:",a.errors),e.preventDefault())}$('[data-type="phone"]').filter(function(){return 0<$(this).parents('[data-action*="trial"]').length}).each(function(){let o=$(this);var t=window.intlTelInput(o.get(0),{utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/utils.js",preferredCountries:["pl","de","ie","us","gb","nl"],autoInsertDialCode:!1,nationalMode:!1,separateDialCode:!0,autoPlaceholder:"off",initialCountry:"pl"});o.on("blur",function(){console.log("Phone field blur triggered"),a.errors=function(e,o,t,r){o=[];let n=r.getSelectedCountryData().iso2,l=r.getNumber();console.log("Validating phone number:",l),function(e){e.removeClass("error"),e.siblings(".error-box").hide()}($(e)),l?"pl"!==n||t.test(l.slice(-9))||(s($(e),errorMessages.phone),o.push(errorMessages.phone)):(s($(e),errorMessages.default),o.push(errorMessages.default));return o}(this,a.errors,a.phoneRegex,t)}),o.on("keydown",function(e){13===e.which&&(console.log("Enter key pressed"),$(this).trigger("blur"),r(e,o,t))}),o.closest("form").find('[data-form="submit-step-two"]').on("click",function(e){console.log("Form submit button clicked"),r(e,o,t)})}),$(document).on("trialStepComplete",function(e,o,t){var r;2===o&&(o=$('[data-element="modal_trial_two"]'),r=$('[data-element="modal_trial_three"]'),o.length&&o.hide(),r.length&&r.show(),console.log("Step 2 completed successfully"),t.license_id)&&console.log("License ID:",t.license_id)})}),$(document).on("formSubmissionComplete",function(e,o,t,r,n){o?DataLayerGatherers.pushEmailSubmittedData(window.myGlobals.clientId,window.myGlobals.shopId,t.data("action"),r.val()):DataLayerGatherers.pushTrackEventError(t.data("action"),t.find("#label").text(),r.val())});