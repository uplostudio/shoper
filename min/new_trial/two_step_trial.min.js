function maskPhoneNumber(e){return e.replace(/(\+48)(\d{7})(\d{2})/,"$1 *** *** *$3")}$(document).ready(()=>{let n={errors:[],phoneRegex:window.validationPatterns.number_phone},c=$('[data-element="trial_wrapper"]'),p,u,l,h=isUsingModal=!1,f=!1,o=(e,a,t)=>{var r=$("#trial-promo"),i=$("#trial-promo-box"),a=a?{name:"Premium",key:"premium"}:t?{name:"Standard+",key:"standard-plus"}:{name:"Standard",key:"standard"},t=e.promotion?.price?.[a.key]?.discount,l=e.price?.[a.key]?.regular_price_year,e=e.promotion?.price?.[a.key]?.[12]?.year?.net,t=(t&&0!==t?r.text(t+"% taniej").show():r.hide(),e=>parseFloat(e||0).toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2}));i.html(`Shoper ${a.name} w promocji <del>${t(l)}</del> <strong>${t(e)} zł</strong> netto / pierwszy rok`)},_=e=>({email:"Niepoprawny adres e-mail. Wprowadź adres w formacie: nazwa@domena.pl",required:"To pole jest wymagane.",phone:"Niepoprawny numer telefonu. Wprowadź poprawny numer telefonu."})[e]||"To pole jest wymagane.",g=(e,a,t,r)=>{DataLayerGatherers.pushDataLayerEvent({event:"formSubmitError",formId:e,email:t,phone:r,action:a,website:"shoper",eventLabel:window.location.pathname})},e=(e,a)=>{var t="checkbox"===e.attr("data-type"),r=t?e.prop("checked"):e.val().trim(),i="email"===a?validationPatterns.email:n.phoneRegex;let l=null;return!t&&!r||t&&!r?l=_("required"):t||i.test(r)||(l=_(a)),e.next(".error-box").remove(),l?(t||e.after(`<span class="error-box">${l}</span>`),e.removeClass("valid").addClass("invalid"),e.siblings(".new__input-label").removeClass("valid active").addClass("invalid")):(e.removeClass("invalid").addClass("valid"),e.siblings(".new__input-label").removeClass("invalid").addClass("valid")),l},y=e=>{var a=$(e),t=window.intlTelInputGlobals.getInstance(e);if(!t)return console.error("IntlTelInput instance not found for field:",e),"IntlTelInput not initialized";let r=null;var e=t.getSelectedCountryData().iso2,i=t.getNumber().trim(),l=(d(a),"Niepoprawny numer telefonu. Wprowadź numer składający się z 9 cyfr w formacie: 123456789");return i?"pl"===e?9===((e=i.replace(/\D/g,"")).startsWith("48")?e.slice(2):e).length&&/^(?:\+48)?(?:(?:[\s-]?\d{3}){3}|\d{9})$/.test(i)||(r=l):t.isValidNumber()||(r=l):r=_("required"),r?v(a,r):s(a,"valid"),r},v=(e,a)=>{e.addClass("error");let t=e.siblings(".error-box");(t=0===t.length?$('<div class="error-box"></div>').insertAfter(e):t).text(a).show()},d=e=>{e.removeClass("error"),e.siblings(".error-box").hide()},s=(e,a)=>{e.siblings(".new__input-label").removeClass("valid invalid").addClass(a),e.removeClass("valid invalid").addClass(a)},a=()=>{var e,a=localStorage.getItem("originalPhoneNumber");a&&((e=$('[data-form="phone_number"]',c)).val(a).prop("disabled",!0),a=window.intlTelInputGlobals.getInstance(e[0]))&&(a.setNumber(originalPhoneNumber),a.disable())},w=e=>{c.find('[data-element^="modal_trial_"]').hide(),c.find(`[data-element="${e}"]`).show(),"modal_trial_three"===e&&a()},t=(a,n)=>{a.preventDefault();let o=n.find('[data-type="email"]'),d=n.find('[data-type="phone"]');var t=n.find('[data-type="checkbox"]'),r=t.length?e(t,"checkbox"):null,i=o.length?e(o,"email"):null,s=d.length?y(d[0]):null;if(i||s||r)g(n.attr("id"),n.data("action"),o.val(),d.val(),t.val());else{let l=n.next().next(),e=n.find(".loading-in-button.is-inner");e.show(),p&&p.abort&&p.abort();i={action:n.data("action"),email:o.val(),"adwords[gclid]":window.myGlobals.gclidValue,"adwords[fbclid]":window.myGlobals.fbclidValue,analyticsId:window.myGlobals.analyticsId,affiliant:shoperAffiliate||"",form_source_url:window.location.href.split("?")[0],...DataLayerGatherers.addUtmDataToForm({})},r=(t.length&&(i[""+t.attr("id")]=t.prop("checked")?1:0),d.length&&((s=window.intlTelInputGlobals.getInstance(d[0]))?i.phone=s.getNumber():console.error("IntlTelInput instance not found for phone field")),h?(i.package=33,i.period=12,localStorage.setItem("isPremiumPackage","true"),localStorage.setItem("isStandardPlusPackage","false")):f?(i.package=38,i.period=12,localStorage.setItem("isPremiumPackage","false"),localStorage.setItem("isStandardPlusPackage","true")):(localStorage.setItem("isPremiumPackage","false"),localStorage.setItem("isStandardPlusPackage","false")),localStorage.getItem("sid"));if(r)try{var m=JSON.parse(r);m.value&&(i.sid=m.value)}catch(a){console.error("Failed to parse SID from localStorage:",a)}u&&(i.sid=u),(p=$.ajax({url:SharedUtils.API_URL,method:"POST",timeout:3e4,data:i})).then(a=>{if(1===a.status){var t,r,i;d.length&&(r=window.intlTelInputGlobals.getInstance(d[0]))&&(t=maskPhoneNumber(r.getNumber()),localStorage.setItem("phoneNumber",t),localStorage.setItem("originalPhoneNumber",r.getNumber())),SharedUtils.handleResponse(a,n,o,l,!0,1),localStorage.removeItem("shoper_affiliate"),"validate_email"===n.data("action")?(t=o.val(),r=localStorage.getItem("trialEmail"),i="true"===localStorage.getItem("trialCompleted"),t===r&&i?w("modal_trial_three"):(localStorage.setItem("trialEmail",t),localStorage.setItem("trialCompleted","false"),w("modal_trial_one_two")),$('[data-form="email"]',c).val(t).prop("disabled",!0),c.show()):"create_trial_step1_new"===n.data("action")&&(w("modal_trial_three"),localStorage.setItem("trialCompleted","true"));let e=0;"#create_trial_step1"===a.step?e=0:a.hasOwnProperty("client_id")?(e=1,dataLayer.push({event:"sign_up",user_id:a.client_id||"undefined",method:"url",shop_id:a.shop_id||"undefined"})):a.hasOwnProperty("redirect")&&(e=2),$(document).trigger("actualTrialStepComplete",[e,a,n]),$('[data-app="trial-domain"]').text(a.host)}else{let e;e=a.hasOwnProperty("code")&&SharedUtils.statusMessages.hasOwnProperty(a.code)?SharedUtils.statusMessages[a.code]:_("email"),v(o,e),g(n.attr("id"),n.data("action"),o.val())}}).catch(e=>{console.error("Ajax error:",e),SharedUtils.handleResponse(e,n,o,l,!1,1)}).always(()=>{e.hide(),p=null})}};let r=$("[data-element='open_trial_two_steps_wrapper']","[data-element='open_trial_wrapper']");r.length&&r.on("click",function(){isUsingModal=!0,formType=isUsingModal?"modal":"inline",c.show();var e=localStorage.getItem("trialEmail"),a="true"===localStorage.getItem("trialCompleted");a?w("modal_trial_three"):w("modal_trial_one_two"),e&&$('[data-form="email"]',c).val(e).prop("disabled",!0),$(document).trigger("trialModalOpened",["new_flow"]),$(document).trigger("trialStepStarted",[a?3:1]),$(document).trigger("trialStepViewed",[a?3:1]),$("body").addClass("overflow-hidden"),h=!0===$(this).data("premium"),f=!0===$(this).data("standard-plus");let t;t=h?{trial_type:"Premium",item_id:"Premium",item_name:"Premium",price:"499"}:f?{trial_type:"Standard+",item_id:"Standard+",item_name:"Standard+",price:"35"}:{trial_type:"Standard",item_id:"Standard",item_name:"Standard",price:"25"},DataLayerGatherers.pushDataLayerEvent({event:"begin_checkout",formId:"create_trial_button",formType:formType,ecommerce:{value:"420",items:[{...t,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname}),window.ShoperPricing.addLoadCallback(function(e){o(e,h,f)})});var i=$("[data-element='close_trial_wrapper']");i.length&&i.on("click",()=>{c.hide(),$("body").removeClass("overflow-hidden")});let m=((a,t)=>{let r;return function(...e){clearTimeout(r),r=setTimeout(()=>{clearTimeout(r),a(...e)},t)}})(function(e,a,t,r){let i;i=h?{trial_type:"Premium",item_id:"Premium",item_name:"Premium",price:"499"}:f?{trial_type:"Standard+",item_id:"Standard+",item_name:"Standard+",price:"35"}:{trial_type:"Standard",item_id:"Standard",item_name:"Standard",price:"25"};r=r&&r.length?r.attr("id"):"unknown";0===a?(formType="inline",DataLayerGatherers.pushDataLayerEvent({event:"begin_checkout",formId:r,formType:formType,ecommerce:{value:"420",items:[{...i,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname})):1===a&&DataLayerGatherers.pushDataLayerEvent({event:"add_payment_info",formId:r,formType:formType,ecommerce:{value:"420",items:[{...i,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname}),JSON.stringify(t)!==JSON.stringify(l)&&(l=t,window.ShoperPricing.addLoadCallback(function(e){o(e,h,f)}))},250);$(document).off("actualTrialStepComplete").on("actualTrialStepComplete",function(e,a,t,r){switch(a){case 0:case 1:m(e,a,t,r)}}),$(document).on("blur",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"]',function(){e($(this),"email")}),$(document).on("blur",'[data-type="phone"]',function(){y(this)}),$(document).on("keydown",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"], [data-type="phone"]',function(e){"Enter"===e.key&&(e.preventDefault(),t(e,$(this).closest("form")))}),$(document).on("click",'[data-form="submit-step-one-two"], [data-form="validate_email"]',function(e){t(e,$(this).closest("form"))}),$(document).on("submit",'[data-action="create_trial_step1_new"], [data-action="validate_email"]',function(e){t(e,$(this))}),$('[data-type="phone"]').each(function(){window.intlTelInput(this,{utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/utils.js",preferredCountries:["pl","de","ie","us","gb","nl"],autoInsertDialCode:!1,nationalMode:!1,separateDialCode:!0,autoPlaceholder:"off",initialCountry:"pl"})}),SharedUtils.checkAndUpdateSID(),setInterval(SharedUtils.checkAndUpdateSID,36e5),"function"==typeof updateAnalytics?updateAnalytics():console.warn("updateAnalytics function is not defined");$(window).on("beforeunload",()=>{p&&p.abort(),$(document).off("blur",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"]'),$(document).off("blur",'[data-type="phone"]'),$(document).off("keydown",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"], [data-type="phone"]'),$(document).off("click",'[data-form="submit-step-one-two"], [data-form="validate_email"]'),$(document).off("submit",'[data-action="create_trial_step1_new"], [data-action="validate_email"]'),r.off("click"),$(document).off("actualTrialStepComplete")}),$(document).ready(function(){let n=$('[data-formid="create_trial_step2_new"], [data-name="reseller"]'),a=n.find('[data-form="submit-step-three"]'),t=n.find('input[name="address[client_type]"]'),r=n.find('input[name="pay_now"]'),i=$('[data-element="company"]'),l=$('[data-element="consument"]'),o=$("#trial-promo-box");function e(){var e="1"===t.filter(":checked").val();i.toggleClass("hide",!e).find("input").prop("disabled",!e).attr("data-exclude",e?null:"true"),l.toggleClass("hide",e).find("input").prop("disabled",e).attr("data-exclude",e?"true":null),n.find(".invalid").removeClass("invalid"),n.find(".error-box").remove()}function d(){var e="1"===r.filter(":checked").val();o.toggle(e),a.find("#label").text(e?"Zapłać teraz":"Rozpocznij darmowy okres próbny")}function s(e,a){e={event:"formSubmitError",formid:e||"",action:a||"","address1[client_type]":n.find('input[name="address[client_type]"]:checked').val()||"","address1[first_name]":n.find('input[name="address[first_name]"]').val()||"","address1[last_name]":n.find('input[name="address[last_name]"]').val()||"","address1[line_1]":n.find('input[name="address[line_1]"]').val()||"","address1[post_code]":n.find('input[name="address[post_code]"]').val()||"","address1[city]":n.find('input[name="address[city]"]').val()||"","address1[country]":n.find('select[name="address[country]"]').val()||"",pay_now:n.find('input[name="pay_now"]:checked').val()||"",accept:1,website:"shoper",eventLabel:window.location.pathname||""};DataLayerGatherers.pushDataLayerEvent(e)}var m,c,p;(p=n.filter('[data-formid="create_trial_step2_new"]')).length&&(m=localStorage.getItem("email"),c=localStorage.getItem("originalPhoneNumber"),p.find('[data-form="email"]').val(m).prop("disabled",!0),p.find('[data-form="phone_number"]').val(c).prop("disabled",!0)),SharedUtils.populateCountrySelect("#address1\\[country\\]"),t.filter('[value="1"]').prop("checked",!0).closest("label").addClass("is-checked"),e(),t.on("change",function(){t.closest("label").removeClass("is-checked"),$(this).closest("label").addClass("is-checked"),e()}),r.on("change",d),a.on("click",function(e){e.preventDefault();{let i="true"===localStorage.getItem("isPremiumPackage"),l="true"===localStorage.getItem("isStandardPlusPackage");validateForm(n[0]).then(e=>{let a=localStorage.getItem("originalPhoneNumber")||"",t=n.data("formid"),r=t;0===e?0<(e=n.find('input[data-type="nip"]:not([data-exclude="true"]):not(:disabled)')).length&&"true"!==e.attr("data-exclude")?performNIPPreflightCheck(n).then(e=>{e?(sendFormDataToURL(n[0],!0),DataLayerGatherers.pushFormSubmitSuccessData(t,r),DataLayerGatherers.pushDataLayerEvent({event:"ecommerce_purchase",ecommerce:{trial:!0,trial_type:i?"Premium":l?"Standard+":"Standard",client_type:"Firma"},eventLabel:window.location.pathname,formType:formType})):(s(t,r,a),pushDataLayerError())}):(sendFormDataToURL(n[0],!0),DataLayerGatherers.pushFormSubmitSuccessData(t,r),DataLayerGatherers.pushDataLayerEvent({event:"ecommerce_purchase",ecommerce:{trial:!0,trial_type:i?"Premium":l?"Standard+":"Standard",client_type:"Konsument"},eventLabel:window.location.pathname,formType:formType})):(s(t,r,a),pushDataLayerError())})}}),n.find("input, select, textarea").each(function(){var e=$(this);e.data("touched",!1),e.data("initial-placeholder",e.attr("placeholder"))}),$(document).on("actualTrialStepComplete",function(e,a,t){var r;2===a&&(a=$('[data-element="modal_trial_three"]'),r=$('[data-element="modal_trial_success"]'),a.length&&a.hide(),r.length)&&r.show()})})}),$(document).on("formSubmissionComplete",function(e,a,t,r,i){if(a){let e="";"true"===localStorage.getItem("isPremiumPackage")?e=33:"true"===localStorage.getItem("isStandardPlusPackage")&&(e=38),DataLayerGatherers.pushTrackEventDataModal(window.myGlobals.clientId,t.data("action"),window.myGlobals.shopId,t.data("action"),r.val(),e)}else DataLayerGatherers.pushTrackEventError(t.data("action"),t.find("#label").text(),r.val())});