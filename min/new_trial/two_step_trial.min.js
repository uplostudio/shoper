function maskPhoneNumber(e){return e.replace(/(\+48)(\d{7})(\d{2})/,"$1 *** *** *$3")}$(document).ready(()=>{let l={errors:[],phoneRegex:window.validationPatterns.number_phone},c=$('[data-element="trial_wrapper"]'),p,u,o,h=!1,f=!1,_=!1,g="inline",d=(e,a,t)=>{var r=$("#trial-promo"),n=$("#trial-promo-box"),a=a?{name:"Premium",key:"premium"}:t?{name:"Standard+",key:"standard-plus"}:{name:"Standard",key:"standard"},t=e.promotion?.price?.[a.key]?.discount,i=e.price?.[a.key]?.regular_price_year,e=e.promotion?.price?.[a.key]?.[12]?.year?.net,t=(t&&0!==t?r.text(t+"% taniej").show():r.hide(),e=>parseFloat(e||0).toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2}));n.html(`Shoper ${a.name} w promocji <del>${t(i)}</del> <strong>${t(e)} zł</strong> netto / pierwszy rok`)},v=e=>({email:"Niepoprawny adres e-mail. Wprowadź adres w formacie: nazwa@domena.pl",required:"To pole jest wymagane.",phone:"Niepoprawny numer telefonu. Wprowadź poprawny numer telefonu."})[e]||"To pole jest wymagane.",y=(e,a,t,r)=>{DataLayerGatherers.pushDataLayerEvent({event:"formSubmitError",formId:e,email:t,phone:r,action:a,website:"shoper",eventLabel:window.location.pathname})},e=(e,a)=>{var t="checkbox"===e.attr("data-type"),r=t?e.prop("checked"):e.val().trim(),n="email"===a?validationPatterns.email:l.phoneRegex;let i=null;return!t&&!r||t&&!r?i=v("required"):t||n.test(r)||(i=v(a)),e.next(".error-box").remove(),i?(t||e.after(`<span class="error-box">${i}</span>`),e.removeClass("valid").addClass("invalid"),e.siblings(".new__input-label").removeClass("valid active").addClass("invalid")):(e.removeClass("invalid").addClass("valid"),e.siblings(".new__input-label").removeClass("invalid").addClass("valid")),i},i=e=>{var a=$(e),t=window.intlTelInputGlobals.getInstance(e);if(!t)return console.error("IntlTelInput instance not found for field:",e),"IntlTelInput not initialized";let r=null;var e=t.getSelectedCountryData().iso2,n=t.getNumber().trim(),i=(s(a),"Niepoprawny numer telefonu. Wprowadź numer składający się z 9 cyfr w formacie: 123456789");return n?"pl"===e?9===((e=n.replace(/\D/g,"")).startsWith("48")?e.slice(2):e).length&&/^(?:\+48)?(?:(?:[\s-]?\d{3}){3}|\d{9})$/.test(n)||(r=i):t.isValidNumber()||(r=i):r=v("required"),r?w(a,r):m(a,"valid"),r},w=(e,a)=>{e.addClass("error");let t=e.siblings(".error-box");(t=0===t.length?$('<div class="error-box"></div>').insertAfter(e):t).text(a).show()},s=e=>{e.removeClass("error"),e.siblings(".error-box").hide()},m=(e,a)=>{e.siblings(".new__input-label").removeClass("valid invalid").addClass(a),e.removeClass("valid invalid").addClass(a)},a=()=>{var e,a=localStorage.getItem("originalPhoneNumber");a&&((e=$('[data-form="phone_number"]',c)).val(a).prop("disabled",!0),a=window.intlTelInputGlobals.getInstance(e[0]))&&(a.setNumber(originalPhoneNumber),a.disable())},b=e=>{c.find('[data-element^="modal_trial_"]').hide(),c.find(`[data-element="${e}"]`).show(),"modal_trial_three"===e&&a()},t=(a,l)=>{a.preventDefault();let o=l.find('[data-type="email"]'),d=l.find('[data-type="phone"]');var t=l.find('[data-type="checkbox"]'),r=t.length?e(t,"checkbox"):null,n=o.length?e(o,"email"):null,s=d.length?i(d[0]):null;if(n||s||r)y(l.attr("id"),l.data("action"),o.val(),d.val(),t.val());else{let i=l.next().next(),e=l.find(".loading-in-button.is-inner");e.show(),p&&p.abort&&p.abort();n={action:l.data("action"),email:o.val(),"adwords[gclid]":window.myGlobals.gclidValue,"adwords[fbclid]":window.myGlobals.fbclidValue,analyticsId:window.myGlobals.analyticsId,affiliant:shoperAffiliate||"",form_source_url:window.location.href.split("?")[0],...DataLayerGatherers.addUtmDataToForm({})},r=(t.length&&(n[""+t.attr("id")]=t.prop("checked")?1:0),d.length&&((s=window.intlTelInputGlobals.getInstance(d[0]))?n.phone=s.getNumber():console.error("IntlTelInput instance not found for phone field")),f?(n.package=33,n.period=12,localStorage.setItem("isPremiumPackage","true"),localStorage.setItem("isStandardPlusPackage","false")):_?(n.package=38,n.period=12,localStorage.setItem("isPremiumPackage","false"),localStorage.setItem("isStandardPlusPackage","true")):(localStorage.setItem("isPremiumPackage","false"),localStorage.setItem("isStandardPlusPackage","false")),localStorage.getItem("sid"));if(r)try{var m=JSON.parse(r);m.value&&(n.sid=m.value)}catch(a){console.error("Failed to parse SID from localStorage:",a)}u&&(n.sid=u),(p=$.ajax({url:SharedUtils.API_URL,method:"POST",timeout:3e4,data:n})).then(a=>{if(1===a.status){var t,r,n;d.length&&(r=window.intlTelInputGlobals.getInstance(d[0]))&&(t=maskPhoneNumber(r.getNumber()),localStorage.setItem("phoneNumber",t),localStorage.setItem("originalPhoneNumber",r.getNumber())),SharedUtils.handleResponse(a,l,o,i,!0,1),localStorage.removeItem("shoper_affiliate"),"validate_email"===l.data("action")?(t=o.val(),r=localStorage.getItem("trialEmail"),n="true"===localStorage.getItem("trialCompleted"),t===r&&n?b("modal_trial_three"):(localStorage.setItem("trialEmail",t),localStorage.setItem("trialCompleted","false"),b("modal_trial_one_two")),$('[data-form="email"]',c).val(t).prop("disabled",!0),c.show()):"create_trial_step1_new"===l.data("action")&&(b("modal_trial_three"),localStorage.setItem("trialCompleted","true"));let e=0;"#create_trial_step1"===a.step?e=0:a.hasOwnProperty("client_id")?(e=1,dataLayer.push({event:"sign_up",user_id:a.client_id||"undefined",method:"url",shop_id:a.shop_id||"undefined"})):a.hasOwnProperty("redirect")&&(e=2),$(document).trigger("actualTrialStepComplete",[e,a,l]),$('[data-app="trial-domain"]').text(a.host)}else{let e;e=a.hasOwnProperty("code")&&SharedUtils.statusMessages.hasOwnProperty(a.code)?SharedUtils.statusMessages[a.code]:v("email"),w(o,e),y(l.attr("id"),l.data("action"),o.val())}}).catch(e=>{console.error("Ajax error:",e),SharedUtils.handleResponse(e,l,o,i,!1,1)}).always(()=>{e.hide(),p=null})}};let r=$("[data-element='open_trial_wrapper']");r.length&&r.on("click",function(){h=!0,g=h?"modal":"inline",c.show();var e=localStorage.getItem("trialEmail"),a="true"===localStorage.getItem("trialCompleted");let t;t=a?(b("modal_trial_three"),2):(b("modal_trial_one_two"),0),DataLayerGatherers.pushFormInteractionEvent("create_trial_button",window.location.pathname,g,0===t?"email":2===t?"last_step":"unknown"),e&&$('[data-form="email"]',c).val(e).prop("disabled",!0),$(document).trigger("trialModalOpened",["new_flow"]),$(document).trigger("trialStepStarted",[a?3:1]),$(document).trigger("trialStepViewed",[a?3:1]),$("body").addClass("overflow-hidden"),f=!0===$(this).data("premium"),_=!0===$(this).data("standard-plus");let r;r=f?{trial_type:"Premium",item_id:"Premium",item_name:"Premium",price:"499"}:_?{trial_type:"Standard+",item_id:"Standard+",item_name:"Standard+",price:"35"}:{trial_type:"Standard",item_id:"Standard",item_name:"Standard",price:"25"},DataLayerGatherers.pushDataLayerEvent({event:"begin_checkout",formId:"create_trial_button",form_type:g,ecommerce:{value:"420",items:[{...r,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname}),window.ShoperPricing.addLoadCallback(function(e){d(e,f,_)})});var n=$("[data-element='close_trial_wrapper']");n.length&&n.on("click",()=>{c.hide(),$("body").removeClass("overflow-hidden")});let S=((a,t)=>{let r;return function(...e){clearTimeout(r),r=setTimeout(()=>{clearTimeout(r),a(...e)},t)}})(function(e,a,t,r){let n;n=f?{trial_type:"Premium",item_id:"Premium",item_name:"Premium",price:"499"}:_?{trial_type:"Standard+",item_id:"Standard+",item_name:"Standard+",price:"35"}:{trial_type:"Standard",item_id:"Standard",item_name:"Standard",price:"25"};r=r&&r.length?r.attr("id"):"unknown";let i;if(h)switch(a){case 0:i="email";break;case 1:i="email_phone";break;case 2:i="last_step";break;default:i="unknown"}else switch(a){case 0:i="email";break;case 1:i="phone";break;case 2:i="last_step";break;default:i="unknown"}DataLayerGatherers.pushFormInteractionEvent(r,window.location.pathname,h?"modal":"inline",i),0===a?DataLayerGatherers.pushDataLayerEvent({event:"begin_checkout",formId:r,form_type:h?"modal":"inline",ecommerce:{value:"420",items:[{...n,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname}):1===a&&DataLayerGatherers.pushDataLayerEvent({event:"add_payment_info",formId:r,form_type:h?"modal":"inline",ecommerce:{value:"420",items:[{...n,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname}),JSON.stringify(t)!==JSON.stringify(o)&&(o=t,window.ShoperPricing.addLoadCallback(function(e){d(e,f,_)}))},250);$(document).off("actualTrialStepComplete").on("actualTrialStepComplete",function(e,a,t,r){S(e,a,t,r)}),$(document).on("blur",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"]',function(){e($(this),"email")}),$(document).on("blur",'[data-type="phone"]',function(){i(this)}),$(document).on("keydown",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"], [data-type="phone"]',function(e){"Enter"===e.key&&(e.preventDefault(),t(e,$(this).closest("form")))}),$(document).on("click",'[data-form="submit-step-one-two"], [data-form="validate_email"]',function(e){g=h?"modal":"inline",t(e,$(this).closest("form"))}),$(document).on("submit",'[data-action="create_trial_step1_new"], [data-action="validate_email"]',function(e){t(e,$(this))}),$('[data-type="phone"]').each(function(){window.intlTelInput(this,{utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/utils.js",preferredCountries:["pl","de","ie","us","gb","nl"],autoInsertDialCode:!1,nationalMode:!1,separateDialCode:!0,autoPlaceholder:"off",initialCountry:"pl"})}),SharedUtils.checkAndUpdateSID(),setInterval(SharedUtils.checkAndUpdateSID,36e5),"function"==typeof updateAnalytics?updateAnalytics():console.warn("updateAnalytics function is not defined");$(window).on("beforeunload",()=>{p&&p.abort(),$(document).off("blur",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"]'),$(document).off("blur",'[data-type="phone"]'),$(document).off("keydown",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"], [data-type="phone"]'),$(document).off("click",'[data-form="submit-step-one-two"], [data-form="validate_email"]'),$(document).off("submit",'[data-action="create_trial_step1_new"], [data-action="validate_email"]'),r.off("click"),$(document).off("actualTrialStepComplete")}),$(document).ready(function(){let l=$('[data-formid="create_trial_step2_new"], [data-name="reseller"]'),a=l.find('[data-form="submit-step-three"]'),t=l.find('input[name="address[client_type]"]'),r=l.find('input[name="pay_now"]'),n=$('[data-element="company"]'),i=$('[data-element="consument"]'),o=$("#trial-promo-box");function e(){var e="1"===t.filter(":checked").val();n.toggleClass("hide",!e).find("input").prop("disabled",!e).attr("data-exclude",e?null:"true"),i.toggleClass("hide",e).find("input").prop("disabled",e).attr("data-exclude",e?"true":null),l.find(".invalid").removeClass("invalid"),l.find(".error-box").remove()}function d(){var e="1"===r.filter(":checked").val();o.toggle(e),a.find("#label").text(e?"Zapłać teraz":"Rozpocznij darmowy okres próbny")}function s(e,a){e={event:"formSubmitError",formid:e||"",action:a||"","address1[client_type]":l.find('input[name="address[client_type]"]:checked').val()||"","address1[first_name]":l.find('input[name="address[first_name]"]').val()||"","address1[last_name]":l.find('input[name="address[last_name]"]').val()||"","address1[line_1]":l.find('input[name="address[line_1]"]').val()||"","address1[post_code]":l.find('input[name="address[post_code]"]').val()||"","address1[city]":l.find('input[name="address[city]"]').val()||"","address1[country]":l.find('select[name="address[country]"]').val()||"",pay_now:l.find('input[name="pay_now"]:checked').val()||"",accept:1,website:"shoper",eventLabel:window.location.pathname||""};DataLayerGatherers.pushDataLayerEvent(e)}var m,c,p;(p=l.filter('[data-formid="create_trial_step2_new"]')).length&&(m=localStorage.getItem("email"),c=localStorage.getItem("originalPhoneNumber"),p.find('[data-form="email"]').val(m).prop("disabled",!0),p.find('[data-form="phone_number"]').val(c).prop("disabled",!0)),SharedUtils.populateCountrySelect("#address1\\[country\\]"),t.filter('[value="1"]').prop("checked",!0).closest("label").addClass("is-checked"),e(),t.on("change",function(){t.closest("label").removeClass("is-checked"),$(this).closest("label").addClass("is-checked"),e()}),r.on("change",d),a.on("click",function(e){e.preventDefault();{let n="true"===localStorage.getItem("isPremiumPackage"),i="true"===localStorage.getItem("isStandardPlusPackage");validateForm(l[0]).then(e=>{let a=localStorage.getItem("originalPhoneNumber")||"",t=l.data("formid"),r=t;0===e?0<(e=l.find('input[data-type="nip"]:not([data-exclude="true"]):not(:disabled)')).length&&"true"!==e.attr("data-exclude")?performNIPPreflightCheck(l).then(e=>{e?(sendFormDataToURL(l[0],!0),DataLayerGatherers.pushFormSubmitSuccessData(t,r),DataLayerGatherers.pushFormInteractionEvent(t,window.location.pathname,h?"modal":"inline","last_step"),DataLayerGatherers.pushDataLayerEvent({event:"ecommerce_purchase",ecommerce:{trial:!0,trial_type:n?"Premium":i?"Standard+":"Standard",client_type:"Firma"},eventLabel:window.location.pathname,form_type:g})):(s(t,r,a),pushDataLayerError())}):(sendFormDataToURL(l[0],!0),DataLayerGatherers.pushFormSubmitSuccessData(t,r),DataLayerGatherers.pushFormInteractionEvent(t,window.location.pathname,h?"modal":"inline","last_step"),DataLayerGatherers.pushDataLayerEvent({event:"ecommerce_purchase",ecommerce:{trial:!0,trial_type:n?"Premium":i?"Standard+":"Standard",client_type:"Konsument"},eventLabel:window.location.pathname,form_type:g})):(s(t,r,a),pushDataLayerError())})}}),l.find("input, select, textarea").each(function(){var e=$(this);e.data("touched",!1),e.data("initial-placeholder",e.attr("placeholder"))}),$(document).on("actualTrialStepComplete",function(e,a,t){var r;2===a&&(a=$('[data-element="modal_trial_three"]'),r=$('[data-element="modal_trial_success"]'),a.length&&a.hide(),r.length)&&r.show()})})}),$(document).on("formSubmissionComplete",function(e,a,t,r,n){if(a){let e="";"true"===localStorage.getItem("isPremiumPackage")?e=33:"true"===localStorage.getItem("isStandardPlusPackage")&&(e=38),DataLayerGatherers.pushTrackEventDataModal(window.myGlobals.clientId,t.data("action"),window.myGlobals.shopId,t.data("action"),r.val(),e)}else DataLayerGatherers.pushTrackEventError(t.data("action"),t.find("#label").text(),r.val())});