function maskPhoneNumber(e){return e.replace(/(\+\d{2})(\d{7})(\d{2})/,"$1 *** *** *$3")}$(document).ready(()=>{window._mfq=window._mfq||[];let n={errors:[],phoneRegex:window.validationPatterns.number_phone},c=e=>{localStorage.setItem("trialEmail",e),localStorage.setItem("trialStartTimestamp",Date.now())};let p=$('[data-element="trial_wrapper"]'),u,h,l,f=isUsingModal=!1,_=!1,o="3588",d=(e,a,t)=>{var r=$("#trial-promo"),i=$("#trial-promo-box"),a=a?{name:"Premium",key:"premium"}:t?{name:"Standard+",key:"standard-plus"}:{name:"Standard",key:"standard"},t=e.promotion?.price?.[a.key]?.discount,l=e.price?.[a.key]?.regular_price_year,e=e.promotion?.price?.[a.key]?.[12]?.year?.net,t=(t&&0!==t?r.text(t+"% taniej").show():r.hide(),e=>parseFloat(e||0).toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2}));i.html(`Shoper ${a.name} w promocji <del>${t(l)}</del> <strong>${t(e)} zł</strong> netto / pierwszy rok`)},y=e=>({email:"Niepoprawny adres e-mail. Wprowadź adres w formacie: nazwa@domena.pl",required:"To pole jest wymagane.",phone:"Niepoprawny numer telefonu. Wprowadź poprawny numer telefonu."})[e]||"To pole jest wymagane.",v=(e,a,t,r)=>{DataLayerGatherers.pushDataLayerEvent({event:"formSubmitError",formId:e,email:t,phone:r,action:a,website:"shoper",eventLabel:window.location.pathname})},e=(e,a)=>{var t="checkbox"===e.attr("data-type"),r=t?e.prop("checked"):e.val().trim(),i="email"===a?validationPatterns.email:n.phoneRegex,l=void 0!==e.attr("required");let o=null;return t?l&&!r&&(o=y("required")):!r&&l?o=y("required"):r&&!i.test(r)&&(o=y(a)),e.next(".error-box").remove(),o?(t||e.after(`<span class="error-box">${o}</span>`),e.removeClass("valid").addClass("invalid"),e.siblings(".new__input-label").removeClass("valid active").addClass("invalid")):(e.removeClass("invalid").addClass("valid"),e.siblings(".new__input-label").removeClass("invalid").addClass("valid")),o},g=e=>{var e=$(e),a=(e.parent().prev().find("select").find(":selected").attr("data-dial-code"),e.val().trim());let t=null;r(e);return a?/^\d{9}$/.test(a)||(t="Niepoprawny numer telefonu. Wprowadź numer składający się z 9 cyfr w formacie: 123456789"):t=y("required"),t?(w(e,t),b(e,"invalid"),addValidationSVG(e,!1)):(hideError(e),b(e,"valid"),addValidationSVG(e,!0)),t},w=(e,a)=>{e.addClass("error");let t=e.siblings(".error-box");(t=0===t.length?$('<div class="error-box"></div>').insertAfter(e):t).text(a).show()},r=e=>{e.removeClass("error"),e.siblings(".error-box").hide()},b=(e,a)=>{e.siblings(".new__input-label").removeClass("valid invalid").addClass(a),e.removeClass("valid invalid").addClass(a)},a=()=>{var e,a=localStorage.getItem("originalPhoneNumber");a&&((e=$('[data-form="phone_number"]',p)).val(a.slice(-9)).prop("disabled",!0),a=a.slice(0,-9),(e=e.parent().prev().find("select")).find(`option[data-dial-code="${a}"]`).prop("selected",!0),e.prop("disabled",!0))},S=e=>{p.find('[data-element^="modal_trial_"]').hide(),p.find(`[data-element="${e}"]`).show(),"modal_trial_three"===e&&a()},t=(a,o)=>{a.preventDefault();let n=o.find('[data-type="email"]'),d=o.find('[data-type="phone"]');var t=o.find('[data-type="checkbox"]'),r=t.length?e(t,"checkbox"):null,i=n.length?e(n,"email"):null,s=d.length?g(d[0]):null;if(i||s||r)v(o.attr("id"),o.data("action"),n.val(),d.val(),t.val());else{let l=o.next().next(),e=o.find(".loading-in-button.is-inner");e.show(),u&&u.abort&&u.abort();i={action:o.data("action"),email:n.val(),"adwords[gclid]":window.myGlobals.gclidValue,"adwords[fbclid]":window.myGlobals.fbclidValue,analytics_id:window.myGlobals.analyticsId,affiliant:shoperAffiliate||"",form_source_url:window.location.href.split("?")[0],...DataLayerGatherers.addUtmDataToForm({})},t=(t.length&&(i[""+t.attr("id")]=t.prop("checked")?1:0),d.length&&(s=d.parent().prev().find("select").find(":selected").attr("data-dial-code"),r=d.val().trim(),i.phone=s+r),f?(i.package=33,i.period=12,localStorage.setItem("isPremiumPackage","true"),localStorage.setItem("isStandardPlusPackage","false")):_?(i.package=38,i.period=12,localStorage.setItem("isPremiumPackage","false"),localStorage.setItem("isStandardPlusPackage","true")):(localStorage.setItem("isPremiumPackage","false"),localStorage.setItem("isStandardPlusPackage","false")),localStorage.getItem("sid"));if(t)try{var m=JSON.parse(t);m.value&&(i.sid=m.value)}catch(a){console.error("Failed to parse SID from localStorage:",a)}h&&(i.sid=h),(u=$.ajax({url:SharedUtils.API_URL,method:"POST",timeout:3e4,data:i})).then(t=>{if(1===t.status){var a,r=o.data("formid"),i=(window._mfq.push(["formSubmitSuccess","#"+r]),d.length&&(i=maskPhoneNumber(r=""+d.parent().prev().find("select").find(":selected").attr("data-dial-code")+d.val().trim()),localStorage.setItem("phoneNumber",i),localStorage.setItem("originalPhoneNumber",r)),SharedUtils.handleResponse(t,o,n,l,!0,1),DataLayerGatherers.pushEmailSubmittedData(window.myGlobals.clientId,window.myGlobals.shopId,o.data("action"),n.val()),localStorage.removeItem("shoper_affiliate"),n.val());"validate_email"===o.data("action")?(r=localStorage.getItem("trialEmail"),a="true"===localStorage.getItem("trialCompleted"),$('[data-element^="card-"]').removeClass("modal--open"),i===r&&a?S("modal_trial_three"):(c(i),localStorage.setItem("trialCompleted","false"),S("modal_trial_one_two")),$('[data-form="email"]',p).val(i).prop("disabled",!0),p.show()):"create_trial_step1_new"===o.data("action")&&($('[data-element^="card-trial-"]').removeClass("modal--open"),$('[data-form="email"]',p).val(i).prop("disabled",!0),S("modal_trial_three"),localStorage.setItem("trialCompleted","true"));let e=0;"#create_trial_step1"===t.step?e=0:t.hasOwnProperty("client_id")?(e=1,dataLayer.push({event:"sign_up",user_id:t.client_id||"undefined",method:"url",shop_id:t.shop_id||"undefined"})):t.hasOwnProperty("redirect")&&(e=2),$(document).trigger("actualTrialStepComplete",[e,t,o]),$('[data-app="trial-domain"]').text(t.host)}else{r=o.data("formid");window._mfq.push(["formSubmitError","#"+r]);let e=null,a=null;t.hasOwnProperty("errors")?(t.errors.hasOwnProperty("email")&&(e=t.errors.email.invalidEmail||y("email")),t.errors.hasOwnProperty("phone")&&(a=t.errors.phone.invalidPhone||"Niepoprawny numer telefonu")):e=t.hasOwnProperty("code")&&SharedUtils.statusMessages.hasOwnProperty(t.code)?SharedUtils.statusMessages[t.code]:t.hasOwnProperty("message")?a=t.message:y("email"),e?w(n,e):hideError(n),a?(w(d,a),addValidationSVG(d,!1)):(hideError(d),addValidationSVG(d,!0),b(d,"valid")),v(o.attr("id"),o.data("action"),n.val())}}).catch(e=>{console.error("Ajax error:",e),SharedUtils.handleResponse(e,o,n,l,!1,1)}).always(()=>{e.hide(),u=null})}};let i=$("[data-element='open_trial_two_steps_wrapper'], [data-element='open_trial_wrapper'], [data-element='open_card-trial-one'], [data-element='open_card-trial-two'], [data-element='open_card-trial-three']");i.length&&i.on("click",function(){window.myGlobals.isUsingModal=!0,formType="modal",p.show();var e=localStorage.getItem("trialEmail"),a="true"===localStorage.getItem("trialCompleted");a?S("modal_trial_three"):S("modal_trial_one_two"),e&&$('[data-form="email"]',p).val(e).prop("disabled",!0),$(document).trigger("trialModalOpened",["new_flow"]),$(document).trigger("trialStepStarted",[a?3:1]),$(document).trigger("trialStepViewed",[a?3:1]),$("body").addClass("overflow-hidden"),f=!0===$(this).data("premium"),_=!0===$(this).data("standard-plus");let t;t=f?{trial_type:"Premium",item_id:"Premium",item_name:"Premium",price:o}:_?{trial_type:"Standard+",item_id:"Standard+",item_name:"Standard+",price:"259"}:{trial_type:"Standard",item_id:"Standard",item_name:"Standard",price:"239"},DataLayerGatherers.pushDataLayerEvent({event:"begin_checkout",formId:"create_trial_button",form_type:formType,ecommerce:{value:"420",items:[{...t,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname}),window.ShoperPricing.addLoadCallback(function(e){d(e,f,_)})});var s=$("[data-element='close_trial_wrapper']");s.length&&s.on("click",()=>{p.hide(),$("body").removeClass("overflow-hidden")});let P=((a,t)=>{let r;return function(...e){clearTimeout(r),r=setTimeout(()=>{clearTimeout(r),a(...e)},t)}})(function(e,a,t,r){let i;i=f?{trial_type:"Premium",item_id:"Premium",item_name:"Premium",price:o}:_?{trial_type:"Standard+",item_id:"Standard+",item_name:"Standard+",price:"259"}:{trial_type:"Standard",item_id:"Standard",item_name:"Standard",price:"239"};r=r&&r.length?r.attr("id"):"unknown";0===a?(formType="inline",DataLayerGatherers.pushDataLayerEvent({event:"begin_checkout",formId:r,form_type:formType,ecommerce:{value:"420",items:[{...i,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname})):1===a&&DataLayerGatherers.pushDataLayerEvent({event:"add_payment_info",formId:r,form_type:formType,ecommerce:{value:"420",items:[{...i,item_category:"Global Header",currency:"PLN",item_variant:"12"}]},eventLabel:window.location.pathname}),JSON.stringify(t)!==JSON.stringify(l)&&(l=t,window.ShoperPricing.addLoadCallback(function(e){d(e,f,_)}))},250);$(document).off("actualTrialStepComplete").on("actualTrialStepComplete",function(e,a,t,r){switch(a){case 0:case 1:P(e,a,t,r)}}),$(document).on("blur",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"]',function(){e($(this),"email")}),$(document).on("blur",'[data-type="phone"]',function(){g(this)}),$(document).on("keydown",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"], [data-type="phone"]',function(e){"Enter"===e.key&&(e.preventDefault(),t(e,$(this).closest("form")))}),$(document).on("click",'[data-form="submit-step-one-two"], [data-form="validate_email"]',function(e){t(e,$(this).closest("form"))}),$(document).on("submit",'[data-action="create_trial_step1_new"], [data-action="validate_email"]',function(e){t(e,$(this))}),SharedUtils.checkAndUpdateSID(),"function"==typeof updateAnalytics?updateAnalytics():console.warn("updateAnalytics function is not defined");$(window).on("beforeunload",()=>{u&&u.abort(),$(document).off("blur",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"]'),$(document).off("blur",'[data-type="phone"]'),$(document).off("keydown",'[data-action="create_trial_step1_new"] [data-type="email"], [data-action="validate_email"] [data-type="email"], [data-type="phone"]'),$(document).off("click",'[data-form="submit-step-one-two"], [data-form="validate_email"]'),$(document).off("submit",'[data-action="create_trial_step1_new"], [data-action="validate_email"]'),i.off("click"),$(document).off("actualTrialStepComplete")}),$(document).ready(function(){let o=$('[data-formid="create_trial_step2_new"], [data-name="reseller"]'),a=o.find('[data-form="submit-step-three"]'),t=o.find('input[name="address[client_type]"]'),r=o.find('input[name="pay_now"]'),i=$('[data-element-type="company"]'),l=$('[data-element-type="consument"]'),n=$("#trial-promo-box");function e(){var e="1"===t.filter(":checked").val();i.toggleClass("hide",!e).find("input").prop("disabled",!e).attr("data-exclude",e?null:"true"),l.toggleClass("hide",e).find("input").prop("disabled",e).attr("data-exclude",e?"true":null),o.find(".invalid").removeClass("invalid"),o.find(".error-box").remove()}function d(){var e="1"===r.filter(":checked").val();n.toggle(e),a.find("#label").text(e?"Zapłać teraz":"Rozpocznij darmowy okres próbny")}function s(e,a){e={event:"formSubmitError",formid:e||"",action:a||"","address1[client_type]":o.find('input[name="address[client_type]"]:checked').val()||"","address1[first_name]":o.find('input[name="address[first_name]"]').val()||"","address1[last_name]":o.find('input[name="address[last_name]"]').val()||"","address1[line_1]":o.find('input[name="address[line_1]"]').val()||"","address1[post_code]":o.find('input[name="address[post_code]"]').val()||"","address1[city]":o.find('input[name="address[city]"]').val()||"","address1[country]":o.find('select[name="address[country]"]').val()||"",pay_now:o.find('input[name="pay_now"]:checked').val()||"",accept:1,website:"shoper",eventLabel:window.location.pathname||""};DataLayerGatherers.pushDataLayerEvent(e)}var m,c,p;(p=o.filter('[data-formid="create_trial_step2_new"]')).length&&(m=localStorage.getItem("email"),c=localStorage.getItem("originalPhoneNumber"),p.find('[data-form="email"]').val(m).prop("disabled",!0),c)&&((m=p.find('[data-form="phone_number"]')).val(c.slice(-9)).prop("disabled",!0),p=c.slice(0,-9),(c=m.parent().prev().find("select")).find(`option[data-dial-code="${p}"]`).prop("selected",!0),c.prop("disabled",!0)),SharedUtils.populateCountrySelect("#address1\\[country\\]"),t.filter('[value="1"]').prop("checked",!0).closest("label").addClass("is-checked"),e(),t.on("change",function(){t.closest("label").removeClass("is-checked"),$(this).closest("label").addClass("is-checked"),e()}),r.on("change",d),a.on("click",function(e){e.preventDefault();{let i="true"===localStorage.getItem("isPremiumPackage"),l="true"===localStorage.getItem("isStandardPlusPackage");validateForm(o[0]).then(e=>{let a=localStorage.getItem("originalPhoneNumber")||"",t=o.data("formid"),r=t;0===e?0<(e=o.find('input[data-type="nip"]:not([data-exclude="true"]):not(:disabled)')).length&&"true"!==e.attr("data-exclude")?performNIPPreflightCheck(o).then(e=>{e?(sendFormDataToURL(o[0],!0),DataLayerGatherers.pushFormSubmitSuccessData(t,r),DataLayerGatherers.pushDataLayerEvent({event:"ecommerce_purchase",ecommerce:{trial:!0,trial_type:i?"Premium":l?"Standard+":"Standard",client_type:"Firma"},eventLabel:window.location.pathname,form_type:formType})):(s(t,r,a),pushDataLayerError())}):(sendFormDataToURL(o[0],!0),DataLayerGatherers.pushFormSubmitSuccessData(t,r),DataLayerGatherers.pushDataLayerEvent({event:"ecommerce_purchase",ecommerce:{trial:!0,trial_type:i?"Premium":l?"Standard+":"Standard",client_type:"Konsument"},eventLabel:window.location.pathname,form_type:formType})):(s(t,r,a),pushDataLayerError())})}}),o.find("input, select, textarea").each(function(){var e=$(this);e.data("touched",!1),e.data("initial-placeholder",e.attr("placeholder"))}),$(document).on("actualTrialStepComplete",function(e,a,t,r){switch(r&&r.data("completed-step",a),a){case 0:case 1:P(e,a,t,r);break;case 2:var i=$('[data-element="modal_trial_three"]'),l=$('[data-element="modal_trial_success"]');i.length&&i.hide(),l.length&&l.show()}})}),(s=localStorage.getItem("trialStartTimestamp"))&&24<=(Date.now()-parseInt(s))/36e5&&localStorage.clear()}),$(document).on("formSubmissionComplete",function(e,a,t,r,i){if(a){let e="";"true"===localStorage.getItem("isPremiumPackage")?e=33:"true"===localStorage.getItem("isStandardPlusPackage")&&(e=38),DataLayerGatherers.pushTrackEventDataModal(window.myGlobals.clientId,t.data("action"),window.myGlobals.shopId,t.data("action"),r.val(),e)}else DataLayerGatherers.pushTrackEventError(t.data("action"),t.find("#label").text(),r.val())});