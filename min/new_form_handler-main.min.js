let API_URL_ADDRESS="https://backend.webflow.prod.shoper.cloud",errorMessages=(validationPatterns={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^\d{9}$/,text:/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ðŚś ,.'-]+$/,nip:/^\d{10}$/,url:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,zipcode:/^(\d{5}|\d{2}-\d{3})$/,address:/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ðŚś ,.'-]+(\s+\d+(\s*[a-zA-Z])?(\s*\/\s*\d+)?)?$/},{email:"Podaj poprawny adres e-mail.",phone:"Podaj poprawny numer telefonu składający się z 9 cyfr bez znaków specjalnych.",text:"Podaj poprawne dane.",nip:"Podaj poprawny numer NIP",url:"Podaj poprawny adres URL.",zipcode:"Podaj poprawny kod pocztowy",default:"To pole jest wymagane"}),omittedAttributes=new Set(["method","name","id","class","aria-label","fs-formsubmit-element","wf-page-id","wf-element-id","autocomplete","layer"]);function validateNIPWithAPI(e){return new Promise((t,r)=>{$.ajax({type:"POST",url:API_URL_ADDRESS,data:{action:"validate_nip",country:"PL",nip:e},success:e=>{t(!0===e)},error:(e,t,a)=>{console.error("NIP validation API error:",a),r(a)}})})}function validateInput(t){var e=t.val().trim(),a=t.prop("required"),r=t.prop("disabled"),n=t.hasClass("active");let i=!t.siblings(".new__input-label").length;var o=t.data("type")||t.attr("type");if(t.removeClass("invalid error"),n||r)t.siblings('.error-box, [class*="error-wrapper"]').hide();else{if(a&&(""===e||i&&"checkbox"===o&&!t.prop("checked")))return showError(t,errorMessages.default,i,!0),Promise.resolve(!0);if(""!==e&&validationPatterns[o]){if(!validationPatterns[o].test(e))return showError(t,errorMessages[o]||errorMessages.default,i,!1),Promise.resolve(!0);if("nip"===o)return validateNIPWithAPI(e).then(e=>e?(hideError(t,i),!1):(showError(t,errorMessages.nip,i,!1),!0)).catch(()=>(hideError(t,i),!1))}hideError(t,i)}return Promise.resolve(!1)}function showError(t,a,e,r){if(t.addClass("invalid"),e){e=t.siblings(".form-input__error-wrapper");e.hide(),e.eq(r?1:0).css("display","flex"),("checkbox"===t.attr("type")?t.prev(".form-checkbox-icon"):t).addClass("error")}else{let e=t.siblings(".error-box");(e=0===e.length?$('<span class="error-box"></span>').insertAfter(t):e).text(a).show()}}function hideError(e,t){t?(e.siblings(".form-input__error-wrapper").hide(),("checkbox"===e.attr("type")?e.prev(".form-checkbox-icon"):e).removeClass("error")):e.siblings(".error-box").hide()}function handleBlur(e){let t=$(e.target);t.data("touched",!0).removeClass("active"),validateInput(t).then(()=>{var e;t.siblings(".new__input-label").length&&((e=t.siblings(".new__input-label")).removeClass("active"),t.val()?e.addClass("valid"):(e.removeClass("valid"),t.attr("placeholder",t.data("initial-placeholder"))))})}function initializeInputs(){$("input, textarea").each(function(){var e=$(this),t=(e.data("touched",!1),!e.siblings(".new__input-label").length);t||(e.data("initial-placeholder",e.attr("placeholder")),e.on({focus:function(){var e=$(this).siblings(".new__input-label");$(this).addClass("active").removeClass("invalid").attr("placeholder",""),e.addClass("active").removeClass("invalid valid"),$(this).siblings(".error-box").hide()},input:function(){var e=$(this).siblings(".new__input-label"),t=0<$(this).val().length;e.toggleClass("active",t),$(this).attr("placeholder",t?"":$(this).data("initial-placeholder")),$(this).hasClass("invalid")&&validateInput($(this))},mouseenter:function(){$(this).siblings(".new__input-label").addClass("hover")},mouseleave:function(){$(this).siblings(".new__input-label").removeClass("hover")}}),t=e.siblings(".new__input-label"),e.val()?(t.addClass("active"),e.attr("placeholder","")):(t.removeClass("active"),e.attr("placeholder",e.data("initial-placeholder")))),e.on("blur",handleBlur)})}function validateForm(e){e=$(e).find("input:not([type='submit']):not([data-exclude='true']):not(:disabled), textarea:not([data-exclude='true']):not(:disabled), select:not([data-exclude='true']):not(:disabled)").map(function(){var e=$(this);return e.closest("[data-element]").hasClass("hide")?Promise.resolve(!1):validateInput(e)}).get();return Promise.all(e).then(e=>e.filter(Boolean).length)}function performNIPPreflightCheck(e){let t=e.find('input[data-type="nip"]');return 0===t.length?Promise.resolve(!0):(e=t.val().trim(),validationPatterns.nip.test(e)?validateNIPWithAPI(e).then(e=>(e?hideError(t,!t.siblings(".new__input-label").length):showError(t,errorMessages.nip,!t.siblings(".new__input-label").length,!1),e)).catch(()=>(hideError(t,!t.siblings(".new__input-label").length),!0)):(showError(t,errorMessages.nip,!t.siblings(".new__input-label").length,!1),Promise.resolve(!1)))}function sendFormDataToURL(e){let a=new FormData,t=$(e),r=t.find(".loading-in-button.is-inner");Array.from(e.attributes).forEach(({name:e,value:t})=>{e=e.replace("data-","");t&&!omittedAttributes.has(e)&&a.append(e,t)});e=t.find("input:not([type='submit']):enabled:not([data-exclude='true']), textarea:enabled, select:enabled");let n={};e.each(function(){var e=$(this),t=e.attr("name"),a=e.attr("type"),t=e.attr("data-form")||t;"radio"===a?e.is(":checked")&&(n[t]=e.val()):"checkbox"===a?n[t]=e.is(":checked")?"1":"0":(a=e.val().trim())&&(n[t]=a)}),Object.entries(n).forEach(([e,t])=>{a.append(e,t)}),$.ajax({type:"POST",url:API_URL_ADDRESS,data:a,processData:!1,contentType:!1,beforeSend:()=>{void 0!==r&&r.show&&r.show()},complete:()=>{void 0!==r&&r.hide&&r.hide()},success:e=>{a.has("host")?1===e.status?(console.log(e),t.siblings(".error-admin").hide(),window.location.href=e.redirect):t.siblings(".error-admin").show():"create_trial_step3"===t.data("name")&&1===e.status?window.location.href=e.redirect:0!==e.status?(t.hide().next().show(),$(document).trigger("submitSuccess",t)):$(document).trigger("submitError",t)},error:()=>{t.siblings(".error-message").show()}})}function handleSubmitClick(e){e.preventDefault();let a=$(this).closest("form");validateForm(a[0]).then(e=>{if(0<e)sendDataLayer({event:"myTrackEvent",eventCategory:"Button modal form error",eventAction:$(this).val(),eventLabel:window.location.href,eventType:a.attr("data-label")||"consult-form"});else{let t=a.find('input[data-type="nip"]');0<t.length?validateNIPWithAPI(t.val().trim()).then(e=>{e?(console.log("nip true"),sendFormDataToURL(a[0])):(console.log("nip invalid"),showError(t,errorMessages.nip,!t.siblings(".new__input-label").length,!1),sendDataLayer({event:"myTrackEvent",eventCategory:"Button modal form error",eventAction:$(this).val(),eventLabel:window.location.href,eventType:a.attr("data-label")||"consult-form"}))}).catch(()=>{sendFormDataToURL(a[0])}):sendFormDataToURL(a[0])}})}function initializeEventListeners(){$("[data-form='submit']").on("click",handleSubmitClick),$("[data-app^='open_'], [data-element^='open_']").on("click",function(){var e=($(this).data("app")||$(this).data("element")).replace(/^open_|_modal_button$/g,""),e=$(`[data-app='${e}'], [data-element='${e}']`),e=(e.addClass("modal--open"),$(document.body).addClass("overflow-hidden"),e.find("form:first"));0<e.length&&e.find(":input:enabled:visible:first").focus()}),$("[fs-formsubmit-element='reset']").on("click",()=>$(".loading-in-button").hide()),$(document).on("submitSuccess submitError",(e,t)=>{sendDataLayer({event:"myTrackEvent",eventCategory:"Button modal form "+("submitSuccess"===e.type?"sent":"error"),eventAction:$(t).find('[type="submit"]').val(),eventType:$(t).attr("data-label"),eventLabel:window.location.href})})}function cleanObject(e={}){return Object.fromEntries(Object.entries(e).filter(([,e])=>null!=e&&""!==e))}function sendDataLayer(e={}){e=cleanObject(e);window.dataLayer&&dataLayer.push(e)}$(document).ready(()=>{initializeInputs(),initializeEventListeners()});