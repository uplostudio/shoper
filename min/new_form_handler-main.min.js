let API_URL_ADDRESS="https://backend.webflow.prod.shoper.cloud",signupFormsActions=["get_inpost","get_ssl","get_app"],omittedAttributes=new Set(["method","name","id","class","aria-label","fs-formsubmit-element","wf-page-id","wf-element-id","autocomplete","layer","form_signature","alternative_form_signature","form_signature_string","form_step","form_type","lead_type","lead_offer"]),validationPatterns={},errorMessages={},formType,isUsingModal,inputsData={inputs:[{email:{active_placeholder:"np. jan.kowalski@domena.pl",error:"Niepoprawny adres e-mail. Wprowadź adres w formacie: nazwa@domena.pl",validationPatterns:/^(?=[a-zA-Z0-9@._%+-]{1,254}$)(?=[a-zA-Z0-9._%+-]{1,64}@)[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/}},{phone_number:{active_placeholder:"w formacie: 123456789",error:"Niepoprawny numer telefonu. Wprowadź numer składający się z 9 cyfr w formacie: 123456789",validationPatterns:/^\d{9}$/}},{phone:{active_placeholder:"w formacie: 123456789",error:"Niepoprawny numer telefonu. Wprowadź numer składający się z 9 cyfr w formacie: 123456789",validationPatterns:/^\d{9}$/}},{url:{active_placeholder:"np. www.twojsklep.pl",error:"Podaj poprawny adres www twojego sklepu w formacie: www.twojsklep.pl",validationPatterns:/^(https?:\/\/)?([a-z\d.-]+)\.([a-z.]{2,6})([\w .-]*)*\/?$/}},{"address1[first_name]":{active_placeholder:"",error:"Podaj poprawne imię",validationPatterns:/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ðŚś ,.'-]+$/}},{"address1[last_name]":{active_placeholder:"",error:"Podaj poprawne nazwisko",validationPatterns:/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ðŚś ,.'-]+$/}},{name:{active_placeholder:"",error:"Podaj poprawne imię i nazwisko",validationPatterns:/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ðŚś ,.'-]+$/}},{"address1[company_name]":{active_placeholder:"",error:"Podaj poprawną nazwę firmy",validationPatterns:/^[A-Za-zĄąĆćĘęŁłŃńÓóŚśŹźŻż0-9\s"\"&.+-]+(?:\s+(?:sp\.|spółka|S\.A\.|SA|z\s+o\.o\.|z\.o\.o\.|z\s+ograniczoną\s+odpowiedzialnością|spółka\s+komandytowa|sp\.\s+k\.|sp\.\s+j\.|spółka\s+jawna))?$/i}},{"address1[nip]":{active_placeholder:"w formacie 1234567890",error:"Podaj poprawny numer NIP w formacie: 12345678990",validationPatterns:/^\d{10}$/}},{"address1[line_1]":{active_placeholder:"",error:"np. Woronicza",validationPatterns:/^[a-zA-ZąćęłńóśźżĄĆĘŁŃÓŚŹŻ0-9\s.,'-]+$/}},{"address1[post_code]":{active_placeholder:"np. 12-345",error:"Podaj poprawny kod pocztowy w formacie: 12-345",validationPatterns:/^(\d{5}|\d{2}-\d{3})$/}},{"address1[city]":{active_placeholder:"",error:"Podaj poprawną nazwę miejscowości",validationPatterns:/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ðŚś ,.'-]+$/}}]};function sanitizeMySQLKeywords(e){var a=new RegExp(`\\b(${["union","select","insert","update","delete","drop","join","where","from","alter","table","database"].join("|")})\\b`,"gi");return e.replace(a,e=>e.charAt(0)+"​"+e.slice(1))}function validateNIPWithAPI(e,a){return $.ajax({type:"POST",url:API_URL_ADDRESS,data:{action:"validate_nip",country:a,nip:e}}).then(e=>!0===e,e=>(console.error("NIP validation API error:",e),!1))}function addValidationSVG(e,a){var t=e.closest('[data-element="input-wrapper"]');t.length&&(t.find(".validation-svg").remove(),e.is(":focus")||e.hasClass("active")||(e=$("<img>",{src:a?"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgOEMwIDMuNTgxNzIgMy41ODE3MiAwIDggMEMxMi40MTgzIDAgMTYgMy41ODE3MiAxNiA4QzE2IDEyLjQxODMgMTIuNDE4MyAxNiA4IDE2QzMuNTgxNzIgMTYgMCAxMi40MTgzIDAgOFoiIGZpbGw9IiMyNEIyNkYiLz4KPHBhdGggZD0iTTYuNTAwMDggMTAuMDg1TDQuNDE1MDggOC4wMDAwNEwzLjcwNTA4IDguNzA1MDRMNi41MDAwOCAxMS41TDEyLjUwMDEgNS41MDAwNEwxMS43OTUxIDQuNzk1MDRMNi41MDAwOCAxMC4wODVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgOEMwIDMuNTgxNzIgMy41ODE3MiAwIDggMEMxMi40MTgzIDAgMTYgMy41ODE3MiAxNiA4QzE2IDEyLjQxODMgMTIuNDE4MyAxNiA4IDE2QzMuNTgxNzIgMTYgMCAxMi40MTgzIDAgOFoiIGZpbGw9IiNFMjNGNDYiLz4KPHBhdGggZD0iTTExLjUgNS4yMDVMMTAuNzk1IDQuNUw4IDcuMjk1TDUuMjA1IDQuNUw0LjUgNS4yMDVMNy4yOTUgOEw0LjUgMTAuNzk1TDUuMjA1IDExLjVMOCA4LjcwNUwxMC43OTUgMTEuNUwxMS41IDEwLjc5NUw4LjcwNSA4TDExLjUgNS4yMDVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K",class:"validation-svg",css:{position:"absolute",right:"1rem",top:"1.5rem",transform:"translateY(-50%)",width:"1rem",height:"1rem",pointerEvents:"none"}}),t.css("position","relative"),t.append(e)))}function validateInput(a){var e=a.val().trim(),t=a.prop("required"),i=a.prop("disabled"),r=a.hasClass("active");let n=!a.siblings(".new__input-label").length;var o=a.data("type")||a.attr("type"),s=a.data("form");a.attr("name")||a.attr("id");if(a.removeClass("invalid error"),r||i)a.siblings('.error-box, [class*="error-wrapper"]').hide();else{if("checkbox"===o||a.closest(".new__trial.is-checkbox").length)return r=a.prop("checked"),t&&!r?(showError(a,"To pole jest wymagane",n,!0),updateInputLabel(a,"invalid"),Promise.resolve(!0)):(hideError(a,n),updateInputLabel(a,"valid"),Promise.resolve(!1));if(t&&""===e)return showError(a,"To pole jest wymagane",n,!0),updateInputLabel(a,"invalid"),Promise.resolve(!0);if(""!==e){i=validationPatterns[o]||validationPatterns[s];if(i)return i.test(e)?"nip"!==o&&"address1[nip]"!==s||!t&&""===e?(hideError(a,n),updateInputLabel(a,"valid"),n||addValidationSVG(a,!0),Promise.resolve(!1)):validateNIPWithAPI(e,a.closest("form").find('select[data-form="address1[country]"]').val()||"PL").then(e=>e?(hideError(a,n),updateInputLabel(a,"valid"),n||addValidationSVG(a,!0),!1):(showError(a,errorMessages["address1[nip]"],n,!1),updateInputLabel(a,"invalid"),n||addValidationSVG(a,!1),!0)).catch(()=>(hideError(a,n),updateInputLabel(a,"valid"),!1)):(showError(a,errorMessages[o]||errorMessages[s]||errorMessages.default,n,!1),updateInputLabel(a,"invalid"),n||addValidationSVG(a,!1),Promise.resolve(!0))}hideError(a,n),updateInputLabel(a,""!==e?"valid":""),n||(""!==e?addValidationSVG(a,!0):a.siblings(".validation-svg").remove())}return Promise.resolve(!1)}function updateInputLabel(e,a){e=e.closest('[data-element="input-wrapper"]').find(".new__input-label");e.length&&e.removeClass("valid invalid").addClass(a)}function pushFormError(e,a){var t=a.closest("form").attr("id"),a=a.attr("data-type")||"undefined";DataLayerGatherers.pushDataLayerEvent({event:"form_error",error_message:e,form_id:t,form_location:"undefined",form_step:a,form_type:"undefined",lead_offer:"standard",lead_type:"new"})}function showError(a,t,e,i){if(pushFormError(t,a),a.addClass("invalid"),e||addValidationSVG(a,!1),e){e=a.siblings(".form-input__error-wrapper");e.hide(),e.eq(i?1:0).css("display","flex"),("checkbox"===a.attr("type")?a.prev(".form-checkbox-icon"):a).addClass("error")}else{let e=a.siblings(".error-box");(e=0===e.length?$('<span class="error-box"></span>').insertAfter(a):e).text(t).show()}}function hideError(e,a){a?(e.siblings(".form-input__error-wrapper").hide(),("checkbox"===e.attr("type")?e.prev(".form-checkbox-icon"):e).removeClass("error")):(e.siblings(".error-box").hide(),e.val()?addValidationSVG(e,!0):e.siblings(".validation-svg").remove())}function handleBlur(e){let t=$(e.target),i=(t.data("touched",!0).removeClass("active"),!t.siblings(".new__input-label").length);validateInput(t).then(e=>{var a;i||((a=t.siblings(".new__input-label")).removeClass("active valid invalid"),e?(a.addClass("invalid"),addValidationSVG(t,!1)):t.val()?(a.addClass("valid"),addValidationSVG(t,!0)):t.siblings(".validation-svg").remove(),t.attr("placeholder",t.data("initial-placeholder")))})}function initializeInputs(){$("input, textarea").each(function(){var e=$(this),r=(e.data("touched",!1),!e.siblings(".new__input-label").length);if(!r){e.data("initial-placeholder",e.attr("placeholder"));let a=e.data("form"),t=e.data("type")||e.attr("type");var r=inputsData.inputs.find(e=>e[a]||e[t]);r&&(r=r[a]||r[t]).active_placeholder&&"{initial}"!==r.active_placeholder&&e.data("active-placeholder",r.active_placeholder),e.on({focus:function(){var e=$(this).siblings(".new__input-label"),e=($(this).addClass("active").removeClass("invalid"),e.removeClass("valid invalid").addClass("active"),$(this).siblings(".error-box").hide(),$(this).siblings(".validation-svg").hide(),$(this).data("active-placeholder"));e&&$(this).attr("placeholder",e)},blur:function(){$(this).removeClass("active"),$(this).attr("placeholder",$(this).data("initial-placeholder")),validateInput($(this)).then(e=>{e?addValidationSVG($(this),!1):$(this).val()?addValidationSVG($(this),!0):$(this).siblings(".validation-svg").remove()})},input:function(){let a=$(this).siblings(".new__input-label"),t=0<$(this).val().length;a.removeClass("valid invalid"),t?a.addClass("active"):a.removeClass("active"),validateInput($(this)).then(e=>{e?a.addClass("invalid"):t&&a.addClass("valid")})},change:function(){validateInput($(this)).then(e=>{addValidationSVG($(this),!e)})}});let i=e.siblings(".new__input-label");i.removeClass("active valid invalid"),e.val()?validateInput(e).then(e=>{e?i.addClass("invalid"):i.addClass("valid")}):e.attr("placeholder",e.data("initial-placeholder"))}e.on("blur",handleBlur)}),$("input, textarea").removeClass("invalid")}function validateForm(e){e=$(e).find("input:not([type='submit']):not([data-exclude='true']):not(:disabled), textarea:not([data-exclude='true']):not(:disabled), select:not([data-exclude='true']):not(:disabled)");return Promise.all(e.filter(function(){return!$(this).closest("[data-element]").hasClass("hide")}).map(function(){return validateInput($(this))}).get()).then(e=>e.filter(Boolean).length)}function performNIPPreflightCheck(e){let a=e.find('input[data-type="nip"]:not([data-exclude="true"]):not(:disabled), input[data-form="address1[nip]"]:not([data-exclude="true"]):not(:disabled)');var t;return 0===a.length?Promise.resolve(!0):(t=a.val().trim(),validationPatterns["address1[nip]"].test(t)?validateNIPWithAPI(t,e.find('select[data-form="address1[country]"]').val()||"PL").then(e=>(e?hideError(a,!a.siblings(".new__input-label").length):showError(a,errorMessages["address1[nip]"],!a.siblings(".new__input-label").length,!1),e)).catch(()=>(hideError(a,!a.siblings(".new__input-label").length),!0)):(showError(a,errorMessages["address1[nip]"],!a.siblings(".new__input-label").length,!1),Promise.resolve(!1)))}function sendFormDataToURL(e,a=!1){let i=new FormData,t=$(e),r=t.find(".loading-in-button.is-inner");Array.from(e.attributes).forEach(({name:e,value:a})=>{e=e.replace("data-","");a&&!omittedAttributes.has(e)&&i.append(e,a)});e=t.find(a?"input:not([type='submit']):not([data-exclude='true']), textarea, select:not([name='countries'])":"input:not([type='submit']):enabled:not([data-exclude='true']), textarea:enabled, select:enabled:not([name='countries'])");let o={},s=["marketplace","country","create_or_move_shop"];e.each(function(){var e,a,t=$(this),i=t.attr("name"),r=t.attr("type"),n=t.attr("data-form")||i;"phone"===t.attr("data-type")?(e=t.parent().prev().find('select[name="countries"]').find(":selected").attr("data-dial-code"),(a=t.val().trim())&&(o[n]=e.replace(/\s+/g,"")+a)):"radio"===r?t.is(":checked")&&(o[n]=t.val()):"checkbox"===r||t.closest(".new__trial.is-checkbox").length?t.is(":checked")&&(e=n||i)&&(s.includes(e)?(o[e]||(o[e]=[]),a=t.siblings("label").text().trim()||t.attr("id")||t.val()||"on",o[e].push(a)):o[e]="1"):(r=t.val().trim())&&(o[n]=r)}),Object.entries(o).forEach(([t,e])=>{var a;s.includes(t)&&Array.isArray(e)?e.forEach((e,a)=>{i.append(t+`[${a}]`,e)}):"address1[company_name]"===t?(a=sanitizeMySQLKeywords(e),i.append(t,a)):i.append(t,e)});DataLayerGatherers.getValueTrackData();i.append("front_page",window.location.host+window.location.pathname+(window.location.hash||"")),i.append("adwords[gclid]",window.myGlobals.gclidValue),i.append("adwords[fbclid]",window.myGlobals.fbclidValue);a=DataLayerGatherers.addUtmDataToForm({});Object.entries(a).forEach(([e,a])=>{i.has(e)||i.append(e,a)}),$.ajax({type:"POST",url:API_URL_ADDRESS,data:i,processData:!1,contentType:!1,beforeSend:()=>{r&&r.show&&r.show()},complete:()=>{r&&r.hide&&r.hide()},success:e=>{i.has("host")?1===e.status?(t.siblings(".error-admin").hide(),"get_admin"!==t.attr("data-action")&&"get_product"!==t.attr("data-action")||dataLayer.push({event:"login",user_id:"undefined",shop_id:"undefined"}),window.location.href=e.redirect):t.siblings(".error-admin").show():"create_trial_step2_new"===t.data("name")&&1===e.status?(localStorage.clear(),window.location.href=e.redirect):0!==e.status?(t.hide().next().show(),$(document).trigger("submitSuccess",t)):$(document).trigger("submitError",t)},error:()=>{t.siblings(".error-message").show()}})}function handleSubmitClick(e){e.preventDefault();let t=$(this).closest("form");e=t.attr("data-action");signupFormsActions.includes(e)&&dataLayer.push({event:"sign_up",user_id:"undefined",method:"url",shop_id:"undefined"}),validateForm(t[0]).then(e=>{if(0<e)DataLayerGatherers.pushTrackEventErrorModal(t.attr("id"),$(this).val(),t.attr("data-label")||"consult-form");else{let a=t.find('input[data-type="nip"]:not([data-exclude="true"]):not(:disabled), input[data-form="address1[nip]"]:not([data-exclude="true"]):not(:disabled)');0<a.length&&(e=a.val().trim(),a.prop("required")||""!==e)?validateNIPWithAPI(e,t.find('select[data-form="address1[country]"]').val()||"PL").then(e=>{e?sendFormDataToURL(t[0]):showError(a,errorMessages["address1[nip]"],!a.siblings(".new__input-label").length,!1)}).catch(()=>{sendFormDataToURL(t[0])}):sendFormDataToURL(t[0])}})}function initializeEventListeners(){$("[data-form='submit']").on("click",handleSubmitClick),$("[data-app^='open_'], [data-element^='open_']").on("click",function(){isUsingModal=!0;var e=($(this).data("app")||$(this).data("element")).replace(/^open_|_modal_button$/g,"");$(`[data-app='${e}'], [data-element='${e}']`).addClass("modal--open"),$(document.body).addClass("overflow-hidden")}),$(document).on("submitSuccess submitError",(e,a)=>{var t={event:"myTrackEvent",eventCategory:"Button modal form "+("submitSuccess"===e.type?"sent":"error"),eventAction:$(a).find('[type="submit"]').val(),eventType:$(a).attr("data-label"),eventLabel:window.location.href};DataLayerGatherers.pushDataLayerEvent(t),"submitSuccess"===e.type&&(t=$(a).attr("id"),DataLayerGatherers.pushDataLayerEvent({event:"generate_lead",form_id:t,form_location:$(a).data("form_location")||"undefined",form_type:$(a).data("form_type")||"undefined",lead_offer:$(a).data("lead_offer")||"undefined",form_step:$(a).data("form_step")||"undefined",lead_type:$(a).data("lead_type")||"undefined"}))}),$('select[data-form="address1[country]"]').on("change",function(){let a=$(this).closest("form").find('input[data-type="nip"], input[data-form="address1[nip]"]');0<a.length&&""!==a.val().trim()&&validateInput(a).then(e=>{updateInputLabel(a,e?"invalid":"valid")})})}function handleSelectPhonePrefix(){var a=$('select[name="countries"]');if(a.length){let n={flags:{svg:"https://flagcdn.com/pl.svg"},dialCode:"+48"},o=!1,e=fetch("https://restcountries.com/v3.1/all?fields=name,flags,idd,translations").then(e=>{if(e.ok)return e.json();throw new Error(`Failed to fetch countries: ${e.status} `+e.statusText)}).catch(e=>{throw new Error("Network request failed: "+e.message)});function s(e){e.empty().append(`
          <option value="">Wybierz kraj</option>
          <option value="${n.flags.svg}" 
                  data-dial-code="${n.dialCode}" 
                  data-full-text="Polska ${n.dialCode}" 
                  selected>
              ${n.dialCode}
          </option>
      `)}function d(e){e.find("option").each(function(){var e=$(this).data("full-text");e&&$(this).text($(this).is(":selected")?$(this).data("dial-code"):e)})}a.each(function(){let i=$(this),r=i.wrap('<div class="country-select-wrapper"></div>').parent();$('<div class="selected-flag"><img class="flag-img" /></div>').insertBefore(i),s(i),r.find(".selected-flag img").attr("src",n.flags.svg),e.then(e=>{if(!Array.isArray(e))throw new Error("Invalid API response: expected array of countries");if(!e.length)throw new Error("Empty countries list received from API");i.empty().append('<option value="">Wybierz kraj</option>');var a=e.find(e=>"Polska"===e.translations.pol?.common);if(!a?.idd?.root)throw new Error("Poland data is missing or invalid in API response");var t=a.idd.root+(a.idd.suffixes?.[0]||""),t=(i.append(`
                  <option value="${a.flags.svg}" 
                          data-dial-code="${t}" 
                          data-full-text="Polska ${t}" 
                          selected>
                      ${t}
                  </option>
              `),r.find(".selected-flag img").attr("src",a.flags.svg),e.filter(e=>"Polska"!==e.translations.pol?.common&&e.idd?.root&&e.flags?.svg));if(!t.length)throw new Error("No valid country data found in API response");t.sort((e,a)=>{e=e.translations.pol?.common||e.name.common,a=a.translations.pol?.common||a.name.common;return e.localeCompare(a)}).forEach(e=>{var a=e.idd.root+(e.idd.suffixes?.[0]||""),t=e.translations.pol?.common||e.name.common;i.append(`
                          <option value="${e.flags.svg}" 
                                  data-dial-code="${a}" 
                                  data-full-text="${t} ${a}">
                              ${a}
                          </option>
                      `)}),d(i)}).catch(e=>{var a,t;a=r,t=i,e=e,o||(console.error("Country select initialization failed:",{error:e?.message||e,status:e?.status,type:e?.type}),o=!0),s(t),d(t),a&&a.find(".selected-flag img").attr("src",n.flags.svg)}),i.on("change",function(){var e=$(this).find(":selected"),a=e.val();e.data("dial-code");a&&(r.find(".selected-flag img").attr("src",a),d($(this)))})})}}function cleanObject(e={}){return Object.fromEntries(Object.entries(e).filter(([,e])=>null!=e&&""!==e))}inputsData.inputs.forEach(e=>{var[e,a]=Object.entries(e)[0];validationPatterns[e]=a.validationPatterns,errorMessages[e]=a.error}),window.validationPatterns=validationPatterns,$(document).ready(()=>{initializeInputs(),initializeEventListeners(),handleSelectPhonePrefix()});